import type {NextApiRequest,NextApiResponse} from 'next'; import Stripe from 'stripe'; const stripe=new Stripe(process.env.STRIPE_SECRET_KEY||'',{apiVersion:'2024-06-20'}); export default async function h(req:NextApiRequest,res:NextApiResponse){ if(req.method!=='POST') return res.status(405).end(); try{ const s=await stripe.checkout.sessions.create({mode:'subscription', line_items:[{price:process.env.NEXT_PUBLIC_STRIPE_PRICE_ID, quantity:1}], success_url:`${process.env.APP_URL}/dashboard?success=1`, cancel_url:`${process.env.APP_URL}/pricing?canceled=1`}); return res.json({url:s.url}); }catch(e:any){ return res.status(500).json({error:e.message}); }}